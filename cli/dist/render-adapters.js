import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
import chalk from 'chalk';
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const TOOLS = ['claude', 'cursor', 'copilot', 'codex'];
function getToolDisplayName(tool) {
    const names = {
        claude: 'Claude',
        cursor: 'Cursor',
        copilot: 'GitHub Copilot',
        codex: 'Codex'
    };
    return names[tool] || tool;
}
function renderTemplate(templateContent, vars) {
    let result = templateContent;
    result = result.replace(/\{\{toolName\}\}/g, vars.toolName);
    result = result.replace(/\{\{toolDisplayName\}\}/g, vars.toolDisplayName);
    result = result.replace(/\{\{version\}\}/g, vars.version);
    result = result.replace(/\{\{generatedDate\}\}/g, vars.generatedDate);
    return result;
}
function getOutputFileName(tool) {
    switch (tool) {
        case 'claude':
            return 'backend-kit-skill.md';
        case 'cursor':
            return 'backend-kit.mdc';
        case 'copilot':
            return 'copilot-instructions.md';
        case 'codex':
            return 'AGENTS.md';
        default:
            return `${tool}-adapter.md`;
    }
}
export async function renderAdapters() {
    const adaptersDir = path.resolve(__dirname, '../adapters');
    const templatesDir = path.join(adaptersDir, 'templates');
    const generatedDir = path.join(adaptersDir, 'generated');
    // Ensure generated directory exists
    if (!fs.existsSync(generatedDir)) {
        fs.mkdirSync(generatedDir, { recursive: true });
    }
    console.log(chalk.bold('\nüîß Rendering adapters from templates...\n'));
    const version = '1.0.0';
    const generatedDate = new Date().toISOString().split('T')[0];
    for (const tool of TOOLS) {
        const templatePath = path.join(templatesDir, `${tool}.md`);
        const outputDir = path.join(generatedDir, tool);
        const outputPath = path.join(outputDir, getOutputFileName(tool));
        if (!fs.existsSync(templatePath)) {
            console.log(chalk.yellow(`  ‚ö†Ô∏è  Template not found: ${tool}.md`));
            continue;
        }
        // Ensure output directory exists
        if (!fs.existsSync(outputDir)) {
            fs.mkdirSync(outputDir, { recursive: true });
        }
        // Read template
        const templateContent = fs.readFileSync(templatePath, 'utf-8');
        // Render with variables
        const vars = {
            toolName: tool,
            toolDisplayName: getToolDisplayName(tool),
            version,
            generatedDate
        };
        const rendered = renderTemplate(templateContent, vars);
        // Add generated header
        const header = `<!-- Generated by Backend Kit v${version} on ${generatedDate} -->\n<!-- DO NOT EDIT - Regenerate with: kit render-adapters -->\n\n`;
        const finalContent = header + rendered;
        // Write output
        fs.writeFileSync(outputPath, finalContent);
        console.log(chalk.green(`  ‚úì ${tool} ‚Üí ${outputPath}`));
    }
    console.log(chalk.bold('\n‚úÖ Adapters rendered successfully!\n'));
}
// CLI command
export async function renderAdaptersCommand() {
    await renderAdapters();
}
// Run if called directly
if (import.meta.url === `file://${__filename}`) {
    renderAdaptersCommand();
}
//# sourceMappingURL=render-adapters.js.map