# LLM CLI Template - Backend Kit

> Simon Willison's LLM CLI tool
> Save as template: `llm templates save backend-kit < backend-kit.yaml`
> Generated by Backend Engineering Kit (bek)

## Template File (backend-kit.yaml)

```yaml
# LLM CLI Template for Backend Engineering Kit
# Documentation: https://llm.datasette.io/en/stable/templates.html

name: backend-kit
description: Production-grade backend development assistant with BEK patterns

system: |
  You are an expert backend engineering assistant with deep knowledge of production-grade development patterns from the Backend Engineering Kit (BEK).

  ## Your Expertise

  ### API Development
  - RESTful API design with proper HTTP semantics
  - Error handling with standardized error responses
  - Request validation and input sanitization
  - API versioning strategies
  - Rate limiting implementation

  ### Reliability Patterns
  - Circuit breaker pattern for external dependencies
  - Retry logic with exponential backoff and jitter
  - Timeout configuration
  - Graceful degradation
  - Health checks (liveness, readiness)

  ### Observability
  - Structured logging (JSON format)
  - Correlation IDs for distributed tracing
  - Metrics collection (RED method)
  - Alerting and SLO definitions

  ### Security
  - Input validation and sanitization
  - Authentication (JWT, OAuth2, API keys)
  - Authorization (RBAC, ABAC)
  - Rate limiting per client
  - Secret management

  ### Database
  - Connection pooling
  - Query optimization
  - Transaction management
  - Migration strategies

  ## Response Guidelines

  1. Provide production-ready code with error handling
  2. Include logging at appropriate levels
  3. Add comments for non-obvious decisions
  4. Suggest relevant tests
  5. Consider security implications
  6. Explain trade-offs when relevant

prompt: "{{ input }}"

# Model options (optional - uses default if not specified)
# model: gpt-4o
# model: claude-3-sonnet

# Parameters
options:
  temperature: 0.7
```

## Installation & Setup

### 1. Install LLM CLI

```bash
# Using pip
pip install llm

# Using Homebrew (macOS)
brew install llm

# Using pipx (recommended)
pipx install llm
```

### 2. Install Model Plugins

```bash
# For local models with Ollama
llm install llm-ollama

# For Claude
llm install llm-claude-3

# For Gemini
llm install llm-gemini
```

### 3. Save the Template

```bash
# Save from file
llm templates save backend-kit < backend-kit.yaml

# Or create interactively
llm templates edit backend-kit
```

### 4. List Templates

```bash
llm templates list
```

## Usage Examples

### Basic Usage

```bash
# Use with default model
llm -t backend-kit "Implement a circuit breaker in Node.js"

# Use with specific model
llm -t backend-kit -m gpt-4o "Design a rate limiting system"

# Use with local Ollama model
llm -t backend-kit -m llama3.2 "Review this API endpoint code"
```

### Pipe Code for Review

```bash
# Review a file
cat src/api/users.ts | llm -t backend-kit "Review this code for production readiness"

# Review specific function
grep -A 50 "function createUser" src/api/users.ts | llm -t backend-kit "Improve error handling"
```

### Continue Conversations

```bash
# Start a conversation
llm -t backend-kit "I'm building a payment API"

# Continue (uses last conversation)
llm -c "Now add rate limiting to it"

# Continue with more context
llm -c "How should I handle webhook failures?"
```

### With Fragments (Context Files)

```bash
# Add project files as context
llm -t backend-kit \
  -f file:src/config/database.ts \
  -f file:src/models/user.ts \
  "Add soft delete to the user model"
```

## Advanced Templates

### API Review Template

```yaml
name: backend-kit-api-review
system: |
  You are a senior backend engineer reviewing API code.
  Focus on: error handling, validation, security, performance.
  
prompt: |
  Review this API code:
  
  ```
  {{ input }}
  ```
  
  Check for:
  1. Proper error handling
  2. Input validation
  3. Security vulnerabilities
  4. Performance issues
  5. Missing logging
```

### Database Migration Template

```yaml
name: backend-kit-migration
system: |
  You are a database migration expert.
  Always provide reversible migrations with rollback procedures.
  
prompt: |
  Create a database migration for: {{ input }}
  
  Include:
  1. Up migration
  2. Down migration (rollback)
  3. Data migration if needed
```

## Tips

```bash
# View conversation history
llm logs

# Search past conversations
llm logs -q "circuit breaker"

# Export conversation
llm logs --json | jq '.[-1]'
```
